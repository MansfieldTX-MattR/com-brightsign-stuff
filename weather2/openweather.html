<!DOCTYPE html>
<html>
    <head>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
        <link id="weather-data-url" href="/weather-data-html">
        <link id="forecast-data-url" href="/forecast-data-html">
        <link rel="stylesheet" href="{{ 'weather2/openweather.css'|static }}">
    </head>
    <body>
        <canvas id="sky" class="overlay"></canvas>
        <div id="sky-overlay" class="overlay"></div>
        <main>
            <div class="main-item current row frame">
                {% include 'weather2/includes/weather-current.html' %}
            </div>
            <div class="main-item row frame datetime-row">
                <div id="current-date"></div>
                <div id="current-time"></div>
            </div>
            <div class="main-item forecast row">
                {% include 'weather2/includes/weather-forecast.html' %}
            </div>
        </main>
        <div id="info"></div>

        <script src="//unpkg.com/suncalc@1.8.0/suncalc.js"></script>

        <!-- Import maps polyfill -->
        <!-- Remove this when import maps will be widely supported -->
        <script async src="//unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

        <script type="importmap">
            {
                "imports": {
                "three": "//unpkg.com/three@0.152.2/build/three.module.js",
                "three/addons/": "//unpkg.com/three@0.152.2/examples/jsm/"
                }
            }
        </script>

        <script type="module" src="{{ 'weather2/skysim.js'|static }}"></script>
        <script id="weather-json" type="application/json">{{ weather_data|tojson(2) }}</script>
        <script id="forecast-json" type="application/json">{{ weather_forecast|tojson(2) }}</script>
        <script src="{{ 'weather2/openweather.js'|static }}"></script>
        <script type="text/javascript">
            (function(){
                const dateFmt = new Intl.DateTimeFormat(
                    'en-US',
                    {
                        year:'numeric',
                        month:'short',
                        day:'numeric',
                        weekday:'short',

                    }
                );
                const timeFmt = new Intl.DateTimeFormat(
                    'en-US',
                    {
                        hour:'numeric',
                        minute:'numeric',
                    }
                );
                const dateEl = document.getElementById('current-date');
                const timeEl = document.getElementById('current-time');

                function updateDatetime(){
                    const now = new Date();
                    dateEl.textContent = dateFmt.format(now);
                    timeEl.textContent = timeFmt.format(now);
                }

                updateDatetime();

                window.setInterval(updateDatetime, 1000);
            })();
        </script>
    </body>
</html>
